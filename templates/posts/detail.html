{% extends '_base.html' %}

{% block main_area %}
    <h1>개인 상세 페이지</h1>
    <div>{{ user.username }}</div>
    <a href = "/users/logout/">로그아웃</a>
    <article class = "post" id = "post-{{ post.id }}">
        <ul>
            <div>
                <h2>
                    <a href = "/posts/feeds/">{{ posts.short_comment }}</a>
                </h2>
                <p>{{ posts.review }} </p>
                <p>{{ posts.user }}</p>
                <p>{{ posts.created }}</p>
                <p>별점</p>
                <div class = "post-tags">
                    {% for tag in post.tags.all %}
                        <a href = "{% url 'posts:tags' tag_name=tag.name %}">#{{ tag.name }}</a>
                    {% endfor %}
                </div>
            </div>
            <!-- 글의 작성자가 로그인 한 사용자라면 팔로우 버튼을 표시하지 않는다 -->
            <!-- (자기 자신을 팔로우 하는 것을 방지) -->
            {% if user != post.user %}
            <form action = "{% url 'users:follow' user_id=user.id %}?next={{ action_redirect_url }}"
                method = "POST">
                {% csrf_token %}
                <button type = "submit" class = "btn btn-primary">
                    <!-- 이 Post 의 작성자가 이미 자신의 팔로잉 목록에 포함된 경우 -->
                    {% if post.user in user.following.all %}
                        Unfollow
                    <!-- 이 Post 의 작성자를 아직 팔로우하지 않은 경우 -->
                    {% else %}
                        Follow
                    {% endif %}
                </button>
            </form>
            {% endif %}
            <!-- 좋아요/댓글 시작 -->
            <div class = "post-buttons">
                <form action ="/post/{{post.pk}}/" method = "POST">
                    {% csrf_token %}
                    <button type = "submit" 
                        {% if user in post.like_users.all %} 
                            style = "color: red;" 
                        {% endif %} class = "btn btn-primary">
                        <!-- Post 의 related_name 으로 지정한 like_users 로 좋아요 누른 사용자 수를 가져옴 -->
                        좋아요({{ posts.like_users.count }})
                    </button>
                </form>
                <span>댓글({{ posts.comment_set.count }})</span>
                <ul>
                    {% for comment in posts.comment_set.all %}
                        <li>{{ comment.content }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div class = "post-comments">
        <ul>
            <P>수정</P>
            <P>삭제</P>   
        </ul>
    </article>
{% endblock %}